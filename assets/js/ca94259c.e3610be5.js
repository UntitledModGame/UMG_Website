"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3999],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),c=u(n),m=o,d=c["".concat(s,".").concat(m)]||c[m]||h[m]||l;return n?a.createElement(d,i(i({ref:t},p),{},{components:n})):a.createElement(d,i({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=n.length,i=new Array(l);i[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[c]="string"==typeof e?e:o,i[1]=r;for(var u=2;u<l;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1044:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>u});var a=n(7462),o=(n(7294),n(3905));const l={slug:"ECS",title:"Why should I use an Entity Component System?",tags:["design","opinion"]},i="Why should I use an Entity Component System?",r={permalink:"/blog/ECS",source:"@site/blog/2023-07-10_why_ecs.md",title:"Why should I use an Entity Component System?",description:"ECSes are really cool and fun! This article will explain why I love them so much.",date:"2023-07-10T00:00:00.000Z",formattedDate:"July 10, 2023",tags:[{label:"design",permalink:"/blog/tags/design"},{label:"opinion",permalink:"/blog/tags/opinion"}],readingTime:8.12,hasTruncateMarker:!0,authors:[],frontMatter:{slug:"ECS",title:"Why should I use an Entity Component System?",tags:["design","opinion"]},prevItem:{title:"Arguments for and against versioning",permalink:"/blog/versioning"},nextItem:{title:"Technical implementation details for UMG",permalink:"/blog/umgtech"}},s={authorsImageUrls:[]},u=[{value:"(Optional reading) What does UMG do?",id:"optional-reading-what-does-umg-do",level:2}],p={toc:u},c="wrapper";function h(e){let{components:t,...l}=e;return(0,o.kt)(c,(0,a.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"ECSes are really cool and fun! This article will explain why I love them so much."),(0,o.kt)("p",null,"If you drop an apple from an aeroplane, sooner or later, it will hit the ground,\nand no longer be an apple.",(0,o.kt)("br",null),"\nAnd the same can be said about pears. And bananas. And most other objects,\nfor that matter."),(0,o.kt)("p",null,"The reason this happens is because of gravity.\nGravity is a rule that works on every object in the universe, which is how rules are supposed to work."),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"apple_falling",src:n(5044).Z,width:"1920",height:"1920"})),(0,o.kt)("hr",null),(0,o.kt)("p",null,"In software development, it seems like a lot of rules aren't programmed this way.\nWith the rise of OOP, programmers have been fixated on binding behaviour to objects,\ninstead of binding behaviour to the system itself."),(0,o.kt)("p",null,"And in gamedev, this is something that has been challenged. (a lot.)\nClassic Entity Component System (ECS) architecture goes as far to say that no behaviour\nshould be bound to game entities at all; they should only have data, and systems (rules)\nshould then act on that data in a global fashion."),(0,o.kt)("p",null,"To sum it up from a gamedev perspective:",(0,o.kt)("br",null)),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"In classic OOP fashion, game entities contain functions. These functions define the behaviour of the entity."),(0,o.kt)("li",{parentName:"ul"},'In classic pure ECS architecture, game entities are not allowed to contain functions. Behaviour is instead defined by "systems", which are external scripts that act on entities.')),(0,o.kt)("p",null,"But hang on... what even is a component? Or an entity, or a system?"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Concept"),(0,o.kt)("th",{parentName:"tr",align:null},"Explanation"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Component"),(0,o.kt)("td",{parentName:"tr",align:null},"Plain old data with a name. Like a position, or an image")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Entity"),(0,o.kt)("td",{parentName:"tr",align:null},"A game object. E.g. an apple, truck, or human. Contains one or more components, grouped together. Does not contain code")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"System"),(0,o.kt)("td",{parentName:"tr",align:null},"Code that processes all entities with certain components")))),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"ecs",src:n(1345).Z,width:"610",height:"497"})),(0,o.kt)("p",null,"To better explain, I'll write a quick hacky example in pseudocode:"),(0,o.kt)("p",null,"Entities / components:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-lua"},'-- an entity containing x, y, image components\nlocal ent = {\n    x = 5, -- `x` component\n    y = 15, -- `y` component\n    image = "cat" -- `image` component\n}\n')),(0,o.kt)("p",null,"Systems:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-lua"},"--[[\nThis is a view of entities that have all these components: (x, y, image)\n(We don't care what other components the entity may have.)\n]]\nlocal drawEntities = entityGroup<x, y, image>()\n\nfunction draw() {\n    -- called whenever we draw to screen\n    for ent in drawEntities {\n        draw(ent.image, ent.x, ent.y)\n    }\n}\n")),(0,o.kt)("p",null,"In this example, we create a global rule.",(0,o.kt)("br",null),"\nWe say: for all entities that have ",(0,o.kt)("inlineCode",{parentName:"p"},"x, y, image")," components,\nwe will draw these entities to the screen."),(0,o.kt)("p",null,"Similar to how gravity is applied globally to all objects,\nwe are applying our draw rule globally to all entities that fit the profile."),(0,o.kt)("p",null,"This allows us to create much more natural rules, which can give way for some nice emergence.\n(I wrote ",(0,o.kt)("a",{parentName:"p",href:"../emergence"},"another blog post on emergence"),", you should give it a read!)"),(0,o.kt)("p",null,'However, the biggest benefit to ECS is not actually the "naturalness" of it;\nrather, the biggest benefit is ',(0,o.kt)("em",{parentName:"p"},"scalability in design."),(0,o.kt)("br",null),"\nWe have applied a ",(0,o.kt)("em",{parentName:"p"},"global")," rule to entities. And if you know anything about software\ndesign, alarm bells should be going off right now. Generally, global state and\nglobal behaviour is really bad, since it leaks out into the rest of the software and causes\na big mess.",(0,o.kt)("br",null),"\nBut in this case, our global rule is not actually leaking anywhere.",(0,o.kt)("br",null),"\nIt's entirely contained within the draw system. Isn't that beautiful?",(0,o.kt)("br",null),"\nWhen we go write a new system, we don't need to care AT ALL about this global rule we made.\nThe only thing we need to care about are the components. But that's completely fine,\nbecause those entities were going to have those components anyway. Besides, there is no\nfunky behaviour tied up in the components; they are just data."),(0,o.kt)("p",null,"In fact, we can even create a new system, say, ",(0,o.kt)("inlineCode",{parentName:"p"},"AnimationSystem")," that changes the ",(0,o.kt)("inlineCode",{parentName:"p"},"image")," component\nwith respect to time to give entities an animation effect.\nWhat's beautiful, is that the ",(0,o.kt)("inlineCode",{parentName:"p"},"AnimationSystem")," ",(0,o.kt)("em",{parentName:"p"},"does not need to care")," about the draw system at all.\nThe systems are effectively communicating through components."),(0,o.kt)("p",null,"And we don't stop there. We can keep scaling. We can keep adding as many systems, as many rules as we want,\nand none of the systems will ever need to interact with each other.\nAnd with every system we add, remember that the rules are applied ",(0,o.kt)("em",{parentName:"p"},"globally"),"."),(0,o.kt)("p",null,"And that's what I find so amazing about this setup. Each system is just fudging with data.\nNo system needs to know more than neccessary; there are no monolithic systems that know too much,\nevery system only takes the bare minimum, and outputs the bare minimum.\nAnd we can afford to do the minimum, because our rules are applied globally; although are\nrules may not be doing much on their own, if we add all our rules together, we get a big complex\nsystem that is super easy to break down."),(0,o.kt)("p",null,"And that's it! I probably ranted for too long here, but you get the idea.",(0,o.kt)("br",null),"\nI see a lot of articles online praising ECS for it's cache performance benefits, and it's\nability to handle large swathes of entities. While this is true, I think what's more important is the\narchitectural side of it.\nIt allows us to handle massively complex systems whilst still being hyper-modular and hyper-generic."),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Before I end this blog post, I want to discuss what I use for my project.\nBecause I don't exactly use a pure ECS as it stands, but most of my ideas have been\nadapted from the classic ECS setup:"),(0,o.kt)("h2",{id:"optional-reading-what-does-umg-do"},"(Optional reading) What does UMG do?"),(0,o.kt)("p",null,'Untitled Mod Game is a project I\'ve been working on for a while.\nUMG uses a "special" ECS setup.',(0,o.kt)("br",null),'\nI call it "special", because we break a few rules:'),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"RuleBreak 1:")," in UMG, entities are typed. (Classic ECS has no types for entities)",(0,o.kt)("br",null),"\n",(0,o.kt)("strong",{parentName:"p"},"RuleBreak 2:")," in UMG, entities can contain functions (OMG!!! EVIL!)",(0,o.kt)("br",null)),(0,o.kt)("p",null,"To visualize things, here is what an entity definition could look like in UMG:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-lua"},'-- a button entity that resets the board state when clicked\n\nlocal resetButton = {\n    image = "button1",\n\n    buttonPressAnimation = {\n        frames = {"button1", "button2", "button3"},\n        time = 0.5\n    },\n\n    buttonPressSound = "click"\n\n    onButtonPress = function(ent)\n        board:reset()\n    end\n}\n')),(0,o.kt)("p",null,"So, what's the reasoning behind breaking these two rules?"),(0,o.kt)("p",null,"Rule 1 (entities having types) is broken partially for efficiency reasons.",(0,o.kt)("br",null),"\nWith types, we can share static data across entities of the same type.\nIt also means that redundant data doesn't need to be sent over the network.\nAll in all, it's just a bit nicer.",(0,o.kt)("sup",{parentName:"p",id:"fnref-1-55f07d"},(0,o.kt)("a",{parentName:"sup",href:"#fn-1-55f07d",className:"footnote-ref"},"1"))),(0,o.kt)("p",null,"Rule 2 (entities containing functions) is broken for practical reasons.",(0,o.kt)("br",null),"\nIn my opinion, practicality is ALWAYS more important than ideology.\nSure, in theory, it makes sense for entities to never contain functions.",(0,o.kt)("br",null),"\nBut what about really niche cases? For example, what if I want to make a gun that clones entities when shot?",(0,o.kt)("br",null),"\nWell, let's try implement it!"),(0,o.kt)("p",null,"We have a few options here:",(0,o.kt)("br",null)),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"OPTION 1:")," Hardcode the clone gun behaviour inside a system that only the clone gun uses.  (Bad, because we are creating a global rule that will only affect one entity type)",(0,o.kt)("br",null),"\n",(0,o.kt)("strong",{parentName:"p"},"OPTION 2:")," Create a sophisticated command-template system. The clone gun can then use an on-hit clone command that's ran when the bullet hits an entity. (Better, but a blatant violation of YAGNI.)",(0,o.kt)("br",null),"\n",(0,o.kt)("strong",{parentName:"p"},"OPTION 3:")," Hardcode the clone gun behaviour inside a function within the clone gun entity. (Violation of pure ECS principles, but other than that, the easiest solution)"),(0,o.kt)("p",null,"Option 1 is obviously stupid, so lets just ignore it."),(0,o.kt)("p",null,"Lets look at what option 2 could look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-lua"},'-- clone gun entity:\nlocal cloneGun = {\n    gun = { bullets = 1, bulletSpeed = 200 },\n\n    bulletHitEffect = {\n        {effect = "clone", target = "target"}\n    }\n}\n\n\n-- But remember, we also need a system to intercept the bullet behaviour:\n-- bulletSystem.lua:\n\nlocal effects = {\n    ...\n}\nlocal targets = {\n    ...\n}\n\numg.on("entityCollide", function(e1, e2)\n    if e1.bullet then \n        -- logic for applying the bullet hit effect here.\n        ... -- apply effect enum to target\n    end\nend)\n\n\n')),(0,o.kt)("p",null,"And now, the 3rd option:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-lua"},"-- clone gun entity:\nlocal cloneGun = {\n    gun = { bullets = 1, bulletSpeed = 200 },\n\n    -- In this example, we put the cloning behaviour directly inside of the\n    -- clone gun entity.\n    -- This is a violation of ECS principles, because behaviour is supposed to be\n    -- applied globally...     but it gets the job done.\n    bulletHit = function(ent, bulletEnt, hitEnt)\n        hitEnt:deepClone()\n    end\n}\n")),(0,o.kt)("p",null,"In an ideal world, option 2 would be the best. "),(0,o.kt)("p",null,"But the world is not ideal. Us programmers have limited time.",(0,o.kt)("br",null),"\nAnd in the case of UMG, ",(0,o.kt)("em",{parentName:"p"},"modders")," have limited patience.\nAre people really going to want to create a whole new system just to clone an entity?",(0,o.kt)("br",null),"\nHell nah! People probably just want to see themselves clone their buddies as fast as possible."),(0,o.kt)("p",null,"So therefore, UMG allows functions inside of entities.\nNot because its good, but because I believe ",(0,o.kt)("strong",{parentName:"p"},"practicality > ideology"),"."),(0,o.kt)("p",null,"Anyway, that's it for this blog post."),(0,o.kt)("p",null,"Thanks for reading this opinion piece!"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Oli")),(0,o.kt)("div",{className:"footnotes"},(0,o.kt)("hr",{parentName:"div"}),(0,o.kt)("ol",{parentName:"div"},(0,o.kt)("li",{parentName:"ol",id:"fn-1-55f07d"},"(Quick note: In most ECSes, entities having no types is due to entities being represented as a single integer. From there, component data is packed into big cache-friendly PoD arrays that systems can zoom over and transform super quickly. UMG is using lua, which doesn't have the cache optimization opportunities that most low level languages have. Hence, entities being explicit types is not harmful to performance since we can't optimize for cache misses anyway lol! I just wanted to emphasize this, because I made it sound like entities being untyped came from an architectural standpoint, whereas it's rather mainly from a performance standpoint.)",(0,o.kt)("a",{parentName:"li",href:"#fnref-1-55f07d",className:"footnote-backref"},"\u21a9")))))}h.isMDXComponent=!0},1345:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ECS-133d8169aa1582c28bdbbe699b21b9ac.png"},5044:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/apple_falling-17185aa8f5d4043e8a8c009704aa9bd0.jpg"}}]);