"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1220],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),h=i,k=u["".concat(s,".").concat(h)]||u[h]||m[h]||o;return n?a.createElement(k,r(r({ref:t},d),{},{components:n})):a.createElement(k,r({ref:t},d))}));function k(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},5642:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(7462),i=(n(7294),n(3905));const o={slug:"DELS",title:"What is Delayed Structuring? (DELS)",tags:["design","umg"]},r=void 0,l={permalink:"/blog/DELS",source:"@site/blog/2024-04-22_DELS.md",title:"What is Delayed Structuring? (DELS)",description:"What is DELS?",date:"2024-04-22T00:00:00.000Z",formattedDate:"April 22, 2024",tags:[{label:"design",permalink:"/blog/tags/design"},{label:"umg",permalink:"/blog/tags/umg"}],readingTime:6.285,hasTruncateMarker:!0,authors:[],frontMatter:{slug:"DELS",title:"What is Delayed Structuring? (DELS)",tags:["design","umg"]},prevItem:{title:"UMG Piping idiom",permalink:"/blog/piping_idiom"},nextItem:{title:"Terminology for UMG",permalink:"/blog/umg_terminology"}},s={authorsImageUrls:[]},p=[{value:"FEAR NOT: Behold the mighty question bus:",id:"fear-not-behold-the-mighty-question-bus",level:2},{value:"But wait!",id:"but-wait",level:2},{value:"But wait! (Episode 2)",id:"but-wait-episode-2",level:2},{value:"But wait! (Episode 3)",id:"but-wait-episode-3",level:2},{value:"OKAY:",id:"okay",level:2},{value:"When do we <em>need</em> DELS?",id:"when-do-we-need-dels",level:2},{value:"When do we <em>NOT need</em> DELS?",id:"when-do-we-not-need-dels",level:2},{value:"Mistaking DELS for direct calls:",id:"mistaking-dels-for-direct-calls",level:2},{value:"Avoiding DELS- Example:",id:"avoiding-dels--example",level:3},{value:"DELS without qbuses / evbuses:",id:"dels-without-qbuses--evbuses",level:2}],d={toc:p},u="wrapper";function m(e){let{components:t,...n}=e;return(0,i.kt)(u,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"What is DELS?"),(0,i.kt)("p",null,"This article is heavily related (and kinda overlapping) with ",(0,i.kt)("a",{parentName:"p",href:"/blog/buses"},"these")," ",(0,i.kt)("a",{parentName:"p",href:"/blog/umgtech"},"two")," articles."),(0,i.kt)("p",null,'"Delayed Structuring" or "DELS" in UMG is when we attempt to "delay" the behaviour or semantics of a system, such that future mods can change it.'),(0,i.kt)("p",null,"For example, overriding abstract methods in OOP languages is an example of DELS.",(0,i.kt)("br",{parentName:"p"}),"\n","With abstract-methods, we are basically saying:",(0,i.kt)("br",{parentName:"p"}),"\n","\"We don't know how this method could work!",(0,i.kt)("br",{parentName:"p"}),"\n",'Therefore we will allow it to be overridden."'),(0,i.kt)("hr",null),(0,i.kt)("p",null,'But, overriding functions in UMG is quite... "meh".',(0,i.kt)("br",{parentName:"p"}),"\n","Because only one mod can override the functions!"),(0,i.kt)("p",null,"Regardless, I think its best to give an example:"),(0,i.kt)("h1",{id:"the-problem"},"The problem:"),(0,i.kt)("p",null,"The rendering-mod is in charge of rendering entities;",(0,i.kt)("br",{parentName:"p"}),"\n","So it needs to know what entities are hidden."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"-- Rendering mod:\n--------\nlocal function isHidden(ent)\n    ...\nend\n")),(0,i.kt)("p",null,"Lets assume we have a mod-setup like so:"),(0,i.kt)("mermaid",{value:"flowchart LR\n    Rendering[Rendering mod]\n    Potions[Potions mod]\n    Ghosts[Ghosts mod]\n    Potions --\x3e Rendering\n    Ghosts --\x3e Rendering"}),(0,i.kt)("p",null,"In the ",(0,i.kt)("inlineCode",{parentName:"p"},"Potions")," mod, we want an invisibility potion.",(0,i.kt)("br",{parentName:"p"}),"\n","And in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Ghosts")," mod, we want ghosts to be invisible, (unless the player has a ghost-busters item.)"),(0,i.kt)("p",null,"(",(0,i.kt)("inlineCode",{parentName:"p"},"Potions")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Ghosts")," know about ",(0,i.kt)("inlineCode",{parentName:"p"},"Rendering"),", but ",(0,i.kt)("inlineCode",{parentName:"p"},"Rendering")," doesn't know about either.)"),(0,i.kt)("p",null,"This... is a problem for us.",(0,i.kt)("br",{parentName:"p"}),"\n","Because the rendering mod knows NOTHING about ghosts...",(0,i.kt)("br",{parentName:"p"}),"\n","And rendering knows NOTHING about potions either.   "),(0,i.kt)("p",null,"And yet.. the ",(0,i.kt)("inlineCode",{parentName:"p"},"isHidden")," check is INSIDE of the ",(0,i.kt)("inlineCode",{parentName:"p"},"rendering")," mod!!!"),(0,i.kt)("p",null,"Hmm.. we need to somehow ",(0,i.kt)("em",{parentName:"p"},"delay")," the ",(0,i.kt)("inlineCode",{parentName:"p"},"isHidden")," check to future mods."),(0,i.kt)("h2",{id:"fear-not-behold-the-mighty-question-bus"},"FEAR NOT: Behold the mighty ",(0,i.kt)("a",{parentName:"h2",href:"/blog/buses"},"question bus:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- Rendering mod:\nlocal function isHidden(ent)\n    return umg.ask("rendering:isHidden", ent)\nend\n')),(0,i.kt)("p",null,"With question-buses, "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- Ghosts:\numg.answer("rendering:isHidden", function(ent)\n    if ent.ghost and (not canSeeGhosts(playerEnt)) then\n        -- player cant see ghosts!\n        return true\n    end\n    return false\nend)\n\n\n-- Potions mod:\numg.answer("rendering:isHidden", function(ent)\n    if ent.potions and ent.potions[INVISIBILITY] then\n        -- entity is invisible!!!\n        return true\n    end\n    return false\nend)\n')),(0,i.kt)("p",null,'This idea of "delaying" behaviour to future mods, is called "Delayed Structuring", or "DELS" for short.'),(0,i.kt)("h2",{id:"but-wait"},"But wait!"),(0,i.kt)("p",null,"There are 2 different values being provided here.",(0,i.kt)("br",{parentName:"p"}),"\n","How is the conflict resolved?",(0,i.kt)("br",{parentName:"p"}),"\n","Ans: We pass in a ",(0,i.kt)("inlineCode",{parentName:"p"},"combiner")," function when we define the question. The ",(0,i.kt)("inlineCode",{parentName:"p"},"combiner")," function is ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Commutative_property"},"commutative."),(0,i.kt)("br",{parentName:"p"}),"\n","In this case, we use logical-OR:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'umg.defineQuestion("rendering:isHidden", OR_FUNCTION)\n')),(0,i.kt)("p",null,"Logical-OR makes sense here.",(0,i.kt)("br",{parentName:"p"}),"\n","(Consider: If a ghost drank an invisibility potion; it should still be invisible)"),(0,i.kt)("h2",{id:"but-wait-episode-2"},"But wait! (Episode 2)"),(0,i.kt)("p",null,'"Why not just create a ',(0,i.kt)("inlineCode",{parentName:"p"},".isHidden"),' component in the rendering mod, and use that???"',(0,i.kt)("br",{parentName:"p"}),"\n","The issue with this ^^^ is that it creates ",(0,i.kt)("em",{parentName:"p"},"very fragile state"),".",(0,i.kt)("br",{parentName:"p"}),"\n","What happens when the potion wears off? Do we just, set ",(0,i.kt)("inlineCode",{parentName:"p"},".isHidden = false"),"?",(0,i.kt)("br",{parentName:"p"}),"\n","If we do that, it will probably break the ghost system!",(0,i.kt)("br",{parentName:"p"}),"\n","(Question buses are a lot better, because they are stateless.)"),(0,i.kt)("h2",{id:"but-wait-episode-3"},"But wait! (Episode 3)"),(0,i.kt)("p",null,'"Why not create a ',(0,i.kt)("inlineCode",{parentName:"p"},".isHidden"),' function on the entity?"',(0,i.kt)("br",{parentName:"p"}),"\n","Yes, we ",(0,i.kt)("em",{parentName:"p"},"COULD")," create a ",(0,i.kt)("inlineCode",{parentName:"p"},".isHidden")," ",(0,i.kt)("a",{parentName:"p",href:"/blog/umg_terminology"},"shcomp"),", and repeatedly wrap it; but that doesn't fit with the ethos of UMG, and doesn't fit with the ECS ethos either.",(0,i.kt)("br",{parentName:"p"}),"\n","Behaviour should reside in ",(0,i.kt)("em",{parentName:"p"},"systems"),", not in components."),(0,i.kt)("br",null),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"okay"},"OKAY:"),(0,i.kt)("p",null,'This is a clear example of "Delayed Structuring", or "DELS".',(0,i.kt)("br",{parentName:"p"}),"\n","This sort of idiom is very important in UMG, since it allows mods to cooperate, and communicate without really knowing the inner details of each other."),(0,i.kt)("p",null,"Although qbuses provide good DELS, they are nothing compared to ",(0,i.kt)("em",{parentName:"p"},"event buses."),(0,i.kt)("br",{parentName:"p"}),"\n","Recall:",(0,i.kt)("br",{parentName:"p"}),"\n","Question bus: Gathers information. Shouldn't modify any state.\nEvent bus: Dispatches information. Can/should modify state."),(0,i.kt)("hr",null),(0,i.kt)("p",null,"Although the above example used qbuses, ",(0,i.kt)("em",{parentName:"p"},"event-buses")," are the ones who carry the real load in UMG;",(0,i.kt)("br",{parentName:"p"}),"\n","This is because the entire control-flow of UMG is routed through a big tree of event calls."),(0,i.kt)("p",null,'(Also, evbuses are quite a bit "stronger", since they are supposed to modify state, and actually transform the world.)'),(0,i.kt)("p",null,"A great example of this is the ",(0,i.kt)("inlineCode",{parentName:"p"},"health-mod"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"local function killEntity(ent)\n    -- kills an entity.\n    --[[ HMM, other mods may want to know about this, right....? ]]\n    \n    ent:delete()\nend\n")),(0,i.kt)("p",null,"Here, we should absolutely be using an event-bus:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'\nlocal function killEntity(ent)\n    -- kills an entity.\n    umg.call("health:entityDeath", ent)\n    --[[\n        here, we just "yeet" an event into the void.\n        Maybe 10 mods will be listening!\n        Maybe 0 mods are listening.\n        We dont really care. The main point,\n        is that we have *DELAYED* the logic for a future mod to handle.\n    ]]\n    \n    ent:delete()\nend\n')),(0,i.kt)("p",null,"Example usage:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'umg.on("health:entityDeath", function(ent)\n    if ent.explosive then\n        -- if entity has `explosive` component, \n        -- then we should blow up the entity\n        makeExplosion(ent)\n    end\nend)\n')),(0,i.kt)("p",null,"Now, the ",(0,i.kt)("em",{parentName:"p"},"downside"),", is that this code will be called by EVERY entity that dies. So the whole setup is very elegant, but also kinda inefficient.",(0,i.kt)("br",{parentName:"p"}),"\n","That's fine though; as long as we make sure the checks are sufficiently simple."),(0,i.kt)("p",null,"We can do more exotic stuff too:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'umg.on("health:entityDeath", function(ent)\n    if ent.username and string.find(ent.username, "dave") then\n        -- if entity is being controlled by a `dave`,\n        -- SHAME DAVE IN ALL-CHAT! LMAO!\n        chat.globalMessage("[SERVER] dave sucks at videogames")\n    end\nend)\n')),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"when-do-we-need-dels"},"When do we ",(0,i.kt)("em",{parentName:"h2"},"need")," DELS?"),(0,i.kt)("p",null,"To clarify, DELS is just when we NEED some code/functionality in a certain place, but we want to avoid making assumptions about the said piece of code."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"We mainly need DELS in base-mods; because base-mods are highly assumptionless.")),(0,i.kt)("h2",{id:"when-do-we-not-need-dels"},"When do we ",(0,i.kt)("em",{parentName:"h2"},"NOT need")," DELS?"),(0,i.kt)("p",null,"We don't need DELS if we are exposing an API, as opposed to systems.",(0,i.kt)("br",{parentName:"p"}),"\n","If we can avoid needing DELS, then that is ideal."),(0,i.kt)("p",null,"For example, a ",(0,i.kt)("inlineCode",{parentName:"p"},"math")," API shouldn't need DELS.",(0,i.kt)("br",{parentName:"p"}),"\n","Similarly, a random-generation library shouldn't need much DELS either.",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"typecheck")," is another example of a mod that doesn't really need DELS"),(0,i.kt)("h2",{id:"mistaking-dels-for-direct-calls"},"Mistaking DELS for direct calls:"),(0,i.kt)("p",null,"Imagine two mods: ",(0,i.kt)("inlineCode",{parentName:"p"},"game")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"dep"),";",(0,i.kt)("br",{parentName:"p"}),"\n","where ",(0,i.kt)("inlineCode",{parentName:"p"},"dep")," is a dependency of ",(0,i.kt)("inlineCode",{parentName:"p"},"game"),":  "),(0,i.kt)("mermaid",{value:"flowchart LR\n    main --\x3e dep"}),(0,i.kt)("p",null,"If ",(0,i.kt)("inlineCode",{parentName:"p"},"dep")," needs something from ",(0,i.kt)("inlineCode",{parentName:"p"},"game"),", then we need DELS.",(0,i.kt)("br",{parentName:"p"}),"\n","This is because ",(0,i.kt)("inlineCode",{parentName:"p"},"dep")," knows NOTHING about ",(0,i.kt)("inlineCode",{parentName:"p"},"main"),"; it doesn't even know if whether it exists."),(0,i.kt)("p",null,"But if ",(0,i.kt)("inlineCode",{parentName:"p"},"main")," needs something from ",(0,i.kt)("inlineCode",{parentName:"p"},"dep"),", then there is no problem.",(0,i.kt)("br",{parentName:"p"}),"\n","Because ",(0,i.kt)("inlineCode",{parentName:"p"},"main")," knows everything about ",(0,i.kt)("inlineCode",{parentName:"p"},"dep")," anyway! There's no issue here."),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h1",{id:"most-important-thing"},(0,i.kt)("em",{parentName:"h1"},"MOST IMPORTANT THING:")),(0,i.kt)("h1",{id:"avoiding-dels"},"Avoiding DELS:"),(0,i.kt)("p",null,"Often, the best course of action is avoid DELS in the first place.",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"SERIOUSLY: I CANNOT OVERSTATE THE IMPORTANCE OF THIS STATEMENT!!!"),"  "),(0,i.kt)("p",null,"DELS is used when we ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"NEED"))," to make an assumption about the system.",(0,i.kt)("br",{parentName:"p"}),"\n","(For example; if we need to know whether an entity is hidden or not)"),(0,i.kt)("p",null,"If we can avoid making assumptions in the first place,\nthen that would be the best course of action."),(0,i.kt)("p",null,'Please don\'t get into a mindset of "use DELS everywhere we can".',(0,i.kt)("br",{parentName:"p"}),"\n","This will only lead to bloat, and pain, and a slow rot of the UMG ecosystem."),(0,i.kt)("h3",{id:"avoiding-dels--example"},"Avoiding DELS- Example:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'"We need ',(0,i.kt)("inlineCode",{parentName:"li"},"ui"),' elements to have a size, and position within the main-scene. We can use DELS to provide our elements with size/position".')),(0,i.kt)("p",null,"NO!! A much better solution, (IMO,) is to instead, allow future-mods to instantiate and control the main-scene themselves.",(0,i.kt)("br",{parentName:"p"}),"\n","This way, they can have full-control over the positioning/sizing of elements.",(0,i.kt)("br",{parentName:"p"}),"\n","Also, future-mods may want to have multiple main-scenes! It's way cleaner."),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"dels-without-qbuses--evbuses"},"DELS without qbuses / evbuses:"),(0,i.kt)("p",null,"Can we do DELS without qbuses / evbuses...???"),(0,i.kt)("p",null,"Of course we can!",(0,i.kt)("br",{parentName:"p"}),"\n","Remember; event/question buses are just ",(0,i.kt)("em",{parentName:"p"},"tools")," that we can use to produce good DELS.",(0,i.kt)("br",{parentName:"p"}),"\n","If we want DELS without ev/q buses, we just need to invent new tools / ideas."),(0,i.kt)("p",null,"If you have a pattern/idea/idiom that you think could produce good DELS in the UMG ecosystem, PLEASE, ",(0,i.kt)("strong",{parentName:"p"},"PLEASE PLEASE PLEASE")," contact me on discord.",(0,i.kt)("br",{parentName:"p"}),"\n","(Discord handle: ",(0,i.kt)("inlineCode",{parentName:"p"},"pakeke"),")"),(0,i.kt)("hr",null),(0,i.kt)("p",null,"Thank you for reading! :)"))}m.isMDXComponent=!0}}]);