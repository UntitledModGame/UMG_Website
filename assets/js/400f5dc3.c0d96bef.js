"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3483],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=a.createContext({}),u=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(o.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,s=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=u(n),d=i,h=m["".concat(o,".").concat(d)]||m[d]||c[d]||s;return n?a.createElement(h,r(r({ref:t},p),{},{components:n})):a.createElement(h,r({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=n.length,r=new Array(s);r[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[m]="string"==typeof e?e:i,r[1]=l;for(var u=2;u<s;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4856:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>c,frontMatter:()=>s,metadata:()=>l,toc:()=>u});var a=n(7462),i=(n(7294),n(3905));const s={slug:"buses",title:"Question buses in UMG",tags:["design","umg"]},r="Question buses in Untitled Mod Game",l={permalink:"/blog/buses",source:"@site/blog/2023-05-10_question_buses.md",title:"Question buses in UMG",description:"Question buses are a cool idea! This article will explain what they are.",date:"2023-05-10T00:00:00.000Z",formattedDate:"May 10, 2023",tags:[{label:"design",permalink:"/blog/tags/design"},{label:"umg",permalink:"/blog/tags/umg"}],readingTime:5.025,hasTruncateMarker:!0,authors:[],frontMatter:{slug:"buses",title:"Question buses in UMG",tags:["design","umg"]},prevItem:{title:"Technical implementation details for UMG",permalink:"/blog/umgtech"},nextItem:{title:"Emergence in games",permalink:"/blog/emergence"}},o={authorsImageUrls:[]},u=[{value:"PRELUDE:",id:"prelude",level:2}],p={toc:u},m="wrapper";function c(e){let{components:t,...s}=e;return(0,i.kt)(m,(0,a.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Question buses are a cool idea! This article will explain what they are."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"prelude"},"PRELUDE:"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"This reading requires a basic understanding of my vision for Untitled Mod Game:"),(0,i.kt)("br",null),'\nAll you need to know is that there are two types of mods, "Base mods",\nand "Playable mods."'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Base mods:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"provide tools and infrastructure for modders to create content"),(0,i.kt)("li",{parentName:"ul"},"do not provide any playable content"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Playable mods:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"provide gameplay and content")))),(0,i.kt)("hr",null),(0,i.kt)("h1",{id:"before-we-look-at-question-buses-lets-understand-event-buses"},"Before we look at question buses, lets understand event buses."),(0,i.kt)("p",null,"Event bus diagram:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"event_bus",src:n(1590).Z,width:"1413",height:"1083"})),(0,i.kt)("p",null,"Event buses are an ",(0,i.kt)("em",{parentName:"p"},"awesome")," tool in the context of Untitled Mod Game."),(0,i.kt)("p",null,"Whenever a significant action happens in a base mod, that base mod can simply\nemit an event to tell other mods that something interesting happened."),(0,i.kt)("p",null,"What's beautiful, is that the base mod emitting the event doesn't care who's listening.\nIt just throws the event into the void; the systems that care about it will\ntag into it. Perhaps no one is listening! Perhaps 10 other mods are listening.\nThe base mod doesn't care."),(0,i.kt)("p",null,"A good example of this is the ",(0,i.kt)("inlineCode",{parentName:"p"},"entityDeath")," event.",(0,i.kt)("br",null),"\nThis event is called automatically when an entity dies, and the entity is\npassed in as the first argument, like so:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- base mod\numg.call("entityDeath", ent)\n')),(0,i.kt)("p",null,"If other systems want to listen to this event, they can use ",(0,i.kt)("inlineCode",{parentName:"p"},"umg.on"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- Meanwhile, in a completely different mod:\numg.on("entityDeath", function(ent)\n    -- plays a death sound when an entity dies.\n    if ent.deathSound then\n        playSound(ent.deathSound)\n    end\nend)\n')),(0,i.kt)("p",null,"Now, this stuff is pretty basic, and this is nothing new. Event buses are a common\npattern, especially in game development."),(0,i.kt)("p",null,"I could give examples of the entity emitting blood particles if it has the ",(0,i.kt)("inlineCode",{parentName:"p"},"meat")," component,\nor spawning a full-health copy of itself if it has the ",(0,i.kt)("inlineCode",{parentName:"p"},"secondLife")," component, but that's not the point\nof this post."),(0,i.kt)("h1",{id:"the-problem-space"},"The problem space:"),(0,i.kt)("p",null,"Okay, so event buses are great for dispatching information when we are within an unknown context."),(0,i.kt)("p",null,"But sometimes we don't want to dispatch information.",(0,i.kt)("br",null),"\nInstead, we may want to ",(0,i.kt)("em",{parentName:"p"},"receive")," information."),(0,i.kt)("p",null,"Behold, the holy ",(0,i.kt)("em",{parentName:"p"},"question bus"),"!!"),(0,i.kt)("p",null,"(I think it's best explained if I give a problem statement, and an example.)"),(0,i.kt)("p",null,"Lets imagine that we have a system for attacking entities.",(0,i.kt)("br",null),"\nThis system needs to know if an entity can attack or not.",(0,i.kt)("br",null),"\nBut it doesn't know what other mods are loaded! It also doesn't know the context of the game\noutside of it's pure little abstract layer."),(0,i.kt)("p",null,"So, we turn to ",(0,i.kt)("em",{parentName:"p"},"question buses.")),(0,i.kt)("hr",null),(0,i.kt)("p",null,"With question buses, we have two functions: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"-- asks a question\numg.ask(question, reducer, ...)\n\n-- answers a question\numg.answer(question, answerFunc)\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ask")," is similar to ",(0,i.kt)("inlineCode",{parentName:"p"},"call"),', in that it initiates the "interaction".'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- attack system\nlocal reducer = operators.OR\n\nlocal isAttackBlocked = umg.ask("isAttackBlocked", reducer, entity, targetEntity)\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"reducer")," is the reducer function; it reduces all the answers to one value\nby repeatedly applying itself to the answers.",(0,i.kt)("br",null),"\n(By nature, the reducer needs to be associative and commutative,\nSo functions like ",(0,i.kt)("inlineCode",{parentName:"p"},"SUM")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"AND")," would also work.)"),(0,i.kt)("hr",null),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"answer")," is similar to ",(0,i.kt)("inlineCode",{parentName:"p"},"on"),", in that it responds to a question.",(0,i.kt)("br",null),"\nInstead of executing something, however, the ",(0,i.kt)("inlineCode",{parentName:"p"},"answer")," should ideally be a pure\nfunction that just returns a result. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- team handler system\n\numg.answer("isAttackBlocked", function(entity, targetEntity)\n    if entity.team == targetEntity.team then\n        -- the entities are in the same team, so the attack should be blocked.\n        return true\n    end\n    return false\nend)\n')),(0,i.kt)("p",null,"We may also have another answer, e.g. inside the stun system:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'umg.answer("isAttackBlocked", function(entity, targetEntity)\n    if entity.stunned then\n        -- entity is stunned, and cannot attack\n        return true \n    end\n    return false\nend)\n')),(0,i.kt)("p",null,'If either of these "answerers" return true, then the attack is blocked.'),(0,i.kt)("hr",null),(0,i.kt)("p",null,"Here's an image that hopefully clarifies the idea further:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"question_bus",src:n(5243).Z,width:"2283",height:"1413"})),(0,i.kt)("hr",null),(0,i.kt)("p",null,"All in all, the pattern can be summarized simply as so:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Regular event buses:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Dispatch information in an abstract manner"),(0,i.kt)("li",{parentName:"ul"},"Doesn't care who is listening"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Question buses:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Gather information in an abstract manner"),(0,i.kt)("li",{parentName:"ul"},"Doesn't care who gives the information")))),(0,i.kt)("hr",null),(0,i.kt)("p",null,"Now, just quickly, I want to recap on why this pattern is actually useful.\n",(0,i.kt)("em",{parentName:"p"},"Why wouldn't you just check if the entities are on the same team in the ",(0,i.kt)("inlineCode",{parentName:"em"},"attack")," code, instead of asking?")),(0,i.kt)("p",null,"With this setup, the ",(0,i.kt)("inlineCode",{parentName:"p"},"attack")," system doesn't ",(0,i.kt)("em",{parentName:"p"},"know"),' about the concept of teams.\nIn fact, the concept of "teams" may not even exist, depending on what mods are loaded!'),(0,i.kt)("p",null,"The attack system is asking a question in an abstract manner, and getting different results\ndepending on the what mods are loaded."),(0,i.kt)("p",null,"This is the exact same thing as event buses, except we are receiving information instead\nof dispatching information."),(0,i.kt)("h1",{id:"is-this-pattern-useful-enough-to-justify-its-existance"},"Is this pattern useful enough to justify it's existance?"),(0,i.kt)("p",null,"It's pretty obvious just from looking at this pattern to see how easily\nit could be abused.",(0,i.kt)("br",null),"\nIt's the same as normal event buses; powerful, yet easy to abuse."),(0,i.kt)("p",null,"So, given the abuse potential, is this pattern worth it?"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Yes"),", I would say so.",(0,i.kt)("br",null),"\nPerhaps this pattern is not useful in other problem spaces, but in UMG where we\nliterally ",(0,i.kt)("strong",{parentName:"p"},"NEED")," a way to receive information unassumingly, question buses just... ",(0,i.kt)("em",{parentName:"p"},"chefs kiss.")),(0,i.kt)("p",null,"To demonstrate why, here are some other questions that could be asked:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'umg.ask("canOpenInventory", OR, inventory, ent) -- whether an inventory can be opened by `ent`\numg.ask("isHidden", OR, ent) -- whether `ent` is hidden\numg.ask("canUseItem", OR ent, itemEnt) -- whether `ent` can use `itemEnt`\numg.ask("canRide", OR, ent, steedEnt) -- whether `ent` can ride `steedEnt`\n\n-- a more interesting one:\numg.ask("getDamageMultiplier", MULTIPLICATION, ent, targetEnt)\n-- returns the damage multiplier for `ent`.\n-- Note that the reducer function is multiplication in this case.\n-- This is because we are combining the damage multipliers from all answers.\n')),(0,i.kt)("h1",{id:"to-conclude"},"To conclude:"),(0,i.kt)("p",null,"question buses are a cool concept! :)"),(0,i.kt)("p",null,"Although they can probably be abused very easily, (same as event buses,)\nthey still provide a very useful pattern for my project."),(0,i.kt)("p",null,"Thanks for reading this opinion piece! I hope I opened your mind a bit."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Oli")))}c.isMDXComponent=!0},1590:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/event_bus-d978dba52e430e92aac31371895ed9d5.png"},5243:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/question_bus-9e398a2cacd9fcbfdf2df65097979097.png"}}]);