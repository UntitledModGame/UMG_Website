"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6262],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>f});var a=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=a.createContext({}),u=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=u(e.components);return a.createElement(s.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(t),m=l,f=p["".concat(s,".").concat(m)]||p[m]||d[m]||r;return t?a.createElement(f,i(i({ref:n},c),{},{components:t})):a.createElement(f,i({ref:n},c))}));function f(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,i=new Array(r);i[0]=m;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[p]="string"==typeof e?e:l,i[1]=o;for(var u=2;u<r;u++)i[u]=t[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2046:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var a=t(7462),l=(t(7294),t(3905));const r={slug:"idioms",title:"Common lua idioms",tags:["coding"]},i="Common lua idioms",o={permalink:"/blog/idioms",source:"@site/blog/2023-09-22_idiomatic_lua.md",title:"Common lua idioms",description:"I have been using lua for a while. (About 4 years as of writing this!)",date:"2023-09-22T00:00:00.000Z",formattedDate:"September 22, 2023",tags:[{label:"coding",permalink:"/blog/tags/coding"}],readingTime:2.305,hasTruncateMarker:!0,authors:[],frontMatter:{slug:"idioms",title:"Common lua idioms",tags:["coding"]},prevItem:{title:"How should we represent entity properties?",permalink:"/blog/properties"},nextItem:{title:"Arguments for and against versioning",permalink:"/blog/versioning"}},s={authorsImageUrls:[]},u=[{value:"Default values with <code>or</code>",id:"default-values-with-or",level:2},{value:"Optional arguments:",id:"optional-arguments",level:2},{value:"Error on undefined access",id:"error-on-undefined-access",level:2},{value:"Private class methods",id:"private-class-methods",level:2}],c={toc:u},p="wrapper";function d(e){let{components:n,...t}=e;return(0,l.kt)(p,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"I have been using lua for a while. (About 4 years as of writing this!)",(0,l.kt)("br",null),"\nIt's a language that I kinda grew up on, and I've learned to love.",(0,l.kt)("br",null),"\nThis article will contain a list of idioms that are common to see in lua.",(0,l.kt)("br",null),"\nLets go!"),(0,l.kt)("h2",{id:"default-values-with-or"},"Default values with ",(0,l.kt)("inlineCode",{parentName:"h2"},"or")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"local x = obj.x or 15\n-- in lua, accessing an undefined table value defaults to `nil`.\n-- `nil` and `false` are falsey values,\n-- So in this example,\n-- If `obj` doesnt have the `.x`, then it will fall back to 15.\n\n-- another common use case:\nobj.x = obj.x or 0\n\n")),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"optional-arguments"},"Optional arguments:"),(0,l.kt)("p",null,"In lua, passing less or more arguments doesn't error."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"local function f(x)\n    print(x)\nend\n\nf(1,2,3) -- this is fine. output: 1\nf() -- this is fine. output: nil\n")),(0,l.kt)("p",null,"We can use this to have optional arguments:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"-- euclidean distance:\nlocal function distance(x, y, z)\n    z = z or 0 -- z is an optional argument!\n    local dx, dy, dz = x*x, y*y, z*z\n    return (dx+dy+dz) ^ 0.5\nend\n\n\nprint(distance(3,4)) -- 5\nprint(distance(3,4,5)) -- 7.071\n")),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"error-on-undefined-access"},"Error on undefined access"),(0,l.kt)("p",null,"In lua, if you access an undefined variable, that variable returns nil.\nExample:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"print(undefined_variable_34389439) -- nil\n-- no error!\n")),(0,l.kt)("p",null,"This is a bit weird, and some people don't like it.",(0,l.kt)("br",null),"\nBut we can change this with ",(0,l.kt)("inlineCode",{parentName:"p"},"__index")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"setmetable"),"."),(0,l.kt)("p",null,"In lua, ",(0,l.kt)("inlineCode",{parentName:"p"},"_G")," is the special table that holds all the globals."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'local function err(t,k,v)\n    error("Accessed an undefined variable: " .. tostring(k))\nend\nsetmetatable(_G, {\n    __index = err\n})\n')),(0,l.kt)("p",null,"Now, if we access an undefined variable:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"print(undefined_variable_34389439)\n-- Error: main.lua:4:\n-- Accessed an undefined variable: undefined_variable_34389439\n")),(0,l.kt)("p",null,"You can do the same with ",(0,l.kt)("inlineCode",{parentName:"p"},"__newindex")," if you want to stop pollution of the global namespace on accident."),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"private-class-methods"},"Private class methods"),(0,l.kt)("p",null,"For the OOP folks out there, who want private methods."),(0,l.kt)("p",null,"Often in lua, you'll see a class setup like so:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'local MyClass = Class()\n\nfunction Class:init()\n    self.x = 0; self.y = 0\nend\n\nfunction Class:privateHi()\n    -- ugh, I wish this could be private!\n    print(self)\nend\n\nfunction Class:hi()\n    self:privateHi()\n    print("hiiii")\nend\n')),(0,l.kt)("p",null,"Private methods can be done like so."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'\nlocal function privateHi(self)\n    -- yay, now i am private!\n    print(self)\nend\n\nfunction Class:hi()\n    privateHi(self)\n    print("hiiii")\nend\n')),(0,l.kt)("p",null,"At first, you may feel uneasy doing it this way, or you may feel cheated.",(0,l.kt)("br",null),"\nRealize though, that all functions in lua are anonymous and first-class. ",(0,l.kt)("inlineCode",{parentName:"p"},"privateHi")," has the exact same bytecode as ",(0,l.kt)("inlineCode",{parentName:"p"},"Class:privateHi"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'0000    FUNCF    4 \n0001    GGET     1   0      ; "print"\n0002    MOV      3   0\n0003    CALL     1   1   2\n0004    RET0     0   1\n')),(0,l.kt)("p",null,"The only difference is that one is inside a table, and one is a local."),(0,l.kt)("hr",null))}d.isMDXComponent=!0}}]);