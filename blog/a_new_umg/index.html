<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">A New UMG | Untitled Mod Game</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-test-site.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-test-site.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/blog/a_new_umg/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="A New UMG | Untitled Mod Game"><meta data-rh="true" name="description" content="UMG is probably going to be re-written from the ground-up."><meta data-rh="true" property="og:description" content="UMG is probably going to be re-written from the ground-up."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-01-08T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="design,umg,coding"><link data-rh="true" rel="icon" href="/img/logo.png"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/blog/a_new_umg/"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/a_new_umg/" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/a_new_umg/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Untitled Mod Game RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Untitled Mod Game Atom Feed"><link rel="stylesheet" href="/assets/css/styles.dd6cc317.css">
<link rel="preload" href="/assets/js/runtime~main.558f61a8.js" as="script">
<link rel="preload" href="/assets/js/main.bdb3d79f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="UMG Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="UMG Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Untitled Mod Game</b></a><a class="navbar__item navbar__link" href="/docs/intro/">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/lessons_from_umg/">Lessons from 3 years of UMG</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/a_new_umg/">A New UMG</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/premature_systems/">Premature event listeners</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/umg_style_guide/">UMG Style Guide</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/zen_of_umg/">The Zen of UMG</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">A New UMG</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-01-08T00:00:00.000Z" itemprop="datePublished">January 8, 2025</time> · <!-- -->9 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>UMG is probably going to be re-written from the ground-up.<br>
<!-- -->What would it look like?</p><p>It has come to my attention that the original version of UMG was written... pretty badly.<br>
<!-- -->I have learned a LOT as an engineer since the genesis of UMG, and I feel like the system honestly <a href="https://martinfowler.com/bliki/SacrificialArchitecture.html" target="_blank" rel="noopener noreferrer">deserves a full rewrite.</a></p><p>I didn&#x27;t intend for this, it&#x27;s mainly because I am a novice engineer, and am still learning.</p><br><p><img loading="lazy" alt="umg_meme" src="/assets/images/old_umg_bad_code-14e1e89c68afcf9368db24578ad9e54b.png" width="609" height="349" class="img_ev3q"></p><br><p>This blog-post will essentially go over a list of things that I think should be changed/made better with the new version of UMG.</p><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="explicit--implicit">Explicit &gt; Implicit<a href="#explicit--implicit" class="hash-link" aria-label="Direct link to Explicit &gt; Implicit" title="Direct link to Explicit &gt; Implicit">​</a></h2><p>The engine shouldn&#x27;t do much stuff implicitly, under the hood.  </p><p>In legacy-umg, we synced entities automatically.<br>
<!-- -->We buffered entities to the ECS automatically.<br>
<!-- -->We added entities to groups automatically after creation.<br>
<!-- -->We loaded images automatically/implicitly.<br>
<!-- -->We loaded sounds automatically/implicitly.  </p><p>^^^ All of this is implicit behaviour!<br>
<!-- -->Implicit code is bad, because it can restrict what the programmers can do,
and it makes it so some code ends up being written as a &quot;hack&quot; around the implicit systems that exist.</p><p>It&#x27;s also makes the system harder to reason about as a whole.</p><p>Next time, make stuff explicit please.</p><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="broader-simpler-systems-and-apis">Broader, simpler systems and APIs:<a href="#broader-simpler-systems-and-apis" class="hash-link" aria-label="Direct link to Broader, simpler systems and APIs:" title="Direct link to Broader, simpler systems and APIs:">​</a></h2><ul><li>Entities should maybe just be regular tables..? Let the modder choose the metatable.</li><li>Entity-id syncing should be a separate system.<ul><li>We should be able to register any table with an ID across the network.</li></ul></li><li>Entities should be added to the ECS <em>manually.</em> Buffering should be explicit.</li><li>Make packet-definitions simple. Typed packets, no dynamic stuff.</li></ul><p>Try to avoid any kind of &quot;deep&quot; APIs or abstractions.<br>
<!-- -->Keep everything broad and flat.</p><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="load-time-validation-is-great">Load-time validation is great<a href="#load-time-validation-is-great" class="hash-link" aria-label="Direct link to Load-time validation is great" title="Direct link to Load-time validation is great">​</a></h2><p>We should attempt to verify as much stuff as possible at load time.
Whether that be name-conflicts, data-integrity issues, or misuse of APIs.</p><p>Good example:<br>
<!-- -->We should have a new function: <code>umg.defineComponent(compName)</code><br>
<!-- -->If two mods try to define the same component, we should throw an error.</p><p>Likewise, if a mod tries to define a non-existant shcomp on an entity,
then we also should throw an error</p><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hybrid-oo-ecs-works-really-well">Hybrid OO-ECS works really well.<a href="#hybrid-oo-ecs-works-really-well" class="hash-link" aria-label="Direct link to Hybrid OO-ECS works really well." title="Direct link to Hybrid OO-ECS works really well.">​</a></h2><p>Pure-ECS has no entity-specific behaviour. Entities cannot contain functions in pure-ECS, they can only contain data.
(This is in contrast to OOP, where functions can exist on objects, and be completely custom)  </p><p>In reality, sometimes we just <em>need</em> entity-specific shit.<br>
<!-- -->The <code>onActivate</code> function shcomp in lootplot was a complete GODSEND.<br>
<!-- -->We need more of that for future versions. It was just amazing, really.</p><p>In future, put more thought into how we can allow for better function-shcomps in the future.</p><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sometimes-its-best-not-to-implement-something-and-to-instead-have-glue-code">Sometimes it&#x27;s best <em>not</em> to implement something, and to instead have glue-code.<a href="#sometimes-its-best-not-to-implement-something-and-to-instead-have-glue-code" class="hash-link" aria-label="Direct link to sometimes-its-best-not-to-implement-something-and-to-instead-have-glue-code" title="Direct link to sometimes-its-best-not-to-implement-something-and-to-instead-have-glue-code">​</a></h2><p>Godot has a <code>move_and_collide()</code> method that you can call inside of the update-method of nodes.<br>
<!-- -->This is really beautiful, because it allows the user to completely override the movement code!  </p><p>Instead of creating some weird, bloaty abstraction (ie an overridable <code>.move()</code> method), godot just lets you call the method directly.</p><p>This is honestly amazing.<br>
<!-- -->And we should use it for syncing, and for entity-movement code too.</p><p>Having a bit of glue code is fine, especially if it avoids having an overreaching abstraction.</p><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-entity-data-structures">Custom entity data structures<a href="#custom-entity-data-structures" class="hash-link" aria-label="Direct link to Custom entity data structures" title="Direct link to Custom entity data structures">​</a></h2><p><code>group:onAdded(func)</code> was great, since allowed for custom data-structures for entities.<br>
<!-- -->More of this please. I think we can do a bit better, too.   </p><p>Encourage helper-wrappers?</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">newEntityGrid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">components</span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">local</span><span class="token plain"> g </span><span class="token operator">=</span><span class="token plain"> umg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">local</span><span class="token plain"> grid </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Grid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    g</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token function" style="color:rgb(80, 250, 123)">onAdded</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        grid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    g</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token function" style="color:rgb(80, 250, 123)">onRemoved</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        grid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token function" style="color:rgb(80, 250, 123)">remove</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> grid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">local</span><span class="token plain"> myGrid </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">newEntityGrid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;fire&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;burnable&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>More importantly, tho, we should aim to provide better features to enable this sort of flexible programming.<br>
<!-- -->Maybe something to do with archetypes in the future?</p><hr><br><br><br><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="things-that-worked-well-for-umg">Things that worked well for UMG:<a href="#things-that-worked-well-for-umg" class="hash-link" aria-label="Direct link to Things that worked well for UMG:" title="Direct link to Things that worked well for UMG:">​</a></h2><ul><li><code>sync.proxyEventToClient</code> this was amazing, simple, and super helpful</li><li><code>sync.autoSyncComponent</code> for simple components, this was amazing</li><li><code>typecheck</code> mod was DAMN AWESOME.</li><li><code>umg.exists</code> was really great</li><li><code>onActivate</code> component (and in general, function shcomps) were great</li><li>wrapping <code>umg.defineEntityType</code> was super cool. (eg <code>defineFood</code>)</li><li>Querying across entities in a global-ish fashion was very elegant. </li></ul><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="events">Events:<a href="#events" class="hash-link" aria-label="Direct link to Events:" title="Direct link to Events:">​</a></h2><ul><li>evbuses, qbuses were pretty good (kinda)</li></ul><p>I was a bit unhappy with how events/questions were defined.
I would like strong-type-lints in the next version, maybe.<br>
<!-- -->Something like:</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">local</span><span class="token plain"> call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> on </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;explosion!&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>^^^ this would allow LuaLS to work.<br>
<!-- -->Not only that, but we could also do stuff like:</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">local</span><span class="token plain"> call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> on </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">proxyEventToClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;mod:event_id&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lets-talk-about-flexibility">Lets talk about &quot;flexibility.&quot;<a href="#lets-talk-about-flexibility" class="hash-link" aria-label="Direct link to Lets talk about &quot;flexibility.&quot;" title="Direct link to Lets talk about &quot;flexibility.&quot;">​</a></h2><p>When I started, a core goal of UMG was &quot;flexibility&quot;.<br>
<!-- -->I changed my mind on this, and now, I think that a more practical goal is to have high cohesion between mods instead.  </p><p>When writing code, you can never write code that accounts for everyone&#x27;s use case. That&#x27;s just not realistic.<br>
<!-- -->I often found that, whilst trying to aim for great-flexibility, I would just end up making premature abstractions that ended up adding useless complexity to the system.<br>
<!-- -->&quot;Oh, but it&#x27;s flexible! Oh wow, it&#x27;s so generic!!!&quot;<br>
<!-- -->No. Shut up!<br>
<!-- -->We don&#x27;t want complex abstractions. The more abstract something is, the harder it is to work with in a practical sense.</p><p>A much better goal, is to prioritize making good, simple assumptions about stuff instead.  </p><p>In general, our goal should be to create hard, well-defined <em>assumptions</em> about systems, rather than trying to shoehorn in a one-size-fits-all approach that just ends up getting nowhere, and doing nothing useful.</p><p>The new goal for UMG is to create maximum <em>cohesion</em> between mods.<br>
<!-- -->If modder-A and modder-B write mods, then both mods should ideally work with each other just fine.</p><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hard-limitations-are-good">Hard limitations are good<a href="#hard-limitations-are-good" class="hash-link" aria-label="Direct link to Hard limitations are good" title="Direct link to Hard limitations are good">​</a></h2><p>At face value, limitations sound objectively bad.<br>
<!-- -->But, like with many things, there is always nuance:</p><p>If a system has more limitations, then we can reason about it more effectively.<br>
<!-- -->Simple example: <code>foo variable is a number</code><br>
<!-- -->^^^ This is a big limitation. But this &quot;limitation&quot; gives us great value.<br>
<!-- -->What value do we get? Lets see!</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[foo is a number]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- we can add,subtract,multiply,divide by foo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- we can plug it into functions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- we can set the value of it robustly</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- DOWNSIDE: we cant represent more exotic types in foo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[foo is any type]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- It&#x27;s flexible</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- DOWNSIDE: We lose ALL of the above benefits</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a kinda weird/contrived example, but it demonstrates the idea.<br>
<!-- -->Limitations can be good, when chosen well!! It&#x27;s all about <em>execution.</em></p><ul><li>Good limitation, is <em>very good</em>.</li><li>Bad limitation, is VERY, VERY BAD.</li></ul><p><strong>EXAMPLE: Revival vs NO Revival of entities:</strong></p><p>At a glance, it may seem like these two setups are pretty much identical.  </p><p>BUT <strong>NO!!!</strong> The second one has a hard limitation: &quot;Dead entities will NEVER be revived.&quot;<br>
<!-- -->This limitation gives us <em>so much more power.</em>  </p><p>Systems that receive a dead-entity can be 100% sure that it will never exist again. So, they can dispose of it happily.<br>
<!-- -->The server doesn&#x27;t need to worry about syncing, and systems that have a hold on the entity-id can happily recycle the ent-id for other stuff.</p><hr><p>Another example:<br>
<!-- -->In minecraft, you can only have 1 block per (x,y,z) position.<br>
<!-- -->(IE, you cannot have blocks that are placed inbetween other blocks)<br>
<!-- -->This sounds bad, but it&#x27;s not. It&#x27;s actually very good!<br>
<!-- -->If there are more limitations, then our code can reason about stuff better:</p><ul><li>There don&#x27;t need to be as many safety checks</li><li>Our systems can be more sure of things</li><li>We can make more powerful/strong assumptions</li></ul><p>And best of all, the one-block per (x,y,z) position fits really well with the game; in fact, it even defines <em>what the game is.</em></p><hr><p><strong>TO SUM IT UP:</strong><br>
<!-- -->Limitations can often provide good value.<br>
<!-- -->What&#x27;s really important is choosing the <em>right</em> limitations, and not putting limits on stuff if there is no clear gain.</p><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="entity-archetypes">Entity Archetypes<a href="#entity-archetypes" class="hash-link" aria-label="Direct link to Entity Archetypes" title="Direct link to Entity Archetypes">​</a></h2><p>Entity <a href="https://ajmmertens.medium.com/building-an-ecs-2-archetypes-and-vectorization-fe21690805f9" target="_blank" rel="noopener noreferrer">Archetypes</a> are a fantastic idea.<br>
<!-- -->Obviously, UMG won&#x27;t get the cache-benefits of them; but we will definitely get the efficiency and design benefits.  </p><p>In general, a UMG Archetype will just be a data structure that represents a Set of components, and stores entities.<br>
<!-- -->Instead of storing entities in groups; groups will store archetypes. Archetypes will store entities.</p><p>Likewise, instead of having logical-AND for group-ownership, what about having functions with signature: <code>fun(arc: Archetype) -&gt; bool</code> that determines whether the entity archetype should be accepted?</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">local</span><span class="token plain"> group </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">archetype</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> archetype</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token function" style="color:rgb(80, 250, 123)">hasComponent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> archetype</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token function" style="color:rgb(80, 250, 123)">hasComponent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;y&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- same as:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">local</span><span class="token plain"> group </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">withComponents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;y&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- (with the legacy systems:)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">local</span><span class="token plain"> group </span><span class="token operator">=</span><span class="token plain"> umg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;y&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(Be wary, though! Archetypes <strong>NEED</strong> to be lazily created, or else, with 100 components, we would have 2^100 archetypes!<br>
<em>In general, there should NEVER be more archetypes than entity-types.</em>)</p><p>We can also use archetypes for other exotic purposes.</p><hr><br><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="smart-eventquestion-buses">Smart event/question buses:<a href="#smart-eventquestion-buses" class="hash-link" aria-label="Direct link to Smart event/question buses:" title="Direct link to Smart event/question buses:">​</a></h2><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> ent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">comp </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> ent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">c2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">func</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- equivalent to :</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">smartOn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;comp&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;c2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> func</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When emitting an event with entity as first argument, instead of looping all listeners,  we can use the archetype of the entity to do an O(1) lookup to get  all of the listeners that will respond to this entity.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="issue-with-this-optimization">ISSUE WITH THIS OPTIMIZATION:<a href="#issue-with-this-optimization" class="hash-link" aria-label="Direct link to ISSUE WITH THIS OPTIMIZATION:" title="Direct link to ISSUE WITH THIS OPTIMIZATION:">​</a></h4><p>We need to store a list of functions inside each archetype, for each event. EG:</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">archetype</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">eventListeners </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">eventName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">f1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> f2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> f3 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This… is quite cache inefficient. HOWEVER, we can fix this by sharing function lists:</p><p>A lot of the time, function lists will be the same across archetypes. (eg. imagine a list of event-listeners that dont require ANY components.  Each archetype would contain the exact same functions for that event!!)</p><p>We can optimize, then, by sharing identical lists across archetypes. This makes caching slightly better, and more efficient.</p><p>In order to discover what lists are identical, we should use bitset data-structure; (the same one we use to compare components in archetypes and groups)<br>
<!-- -->Each position in the bitset references an event method.<br>
<!-- -->Whereas with archetypes/entities, each position in the bitset refers to a component-string.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/design/">design</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/umg/">umg</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/coding/">coding</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/lessons_from_umg/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Lessons from 3 years of UMG</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/premature_systems/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Premature event listeners</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#explicit--implicit" class="table-of-contents__link toc-highlight">Explicit &gt; Implicit</a></li><li><a href="#broader-simpler-systems-and-apis" class="table-of-contents__link toc-highlight">Broader, simpler systems and APIs:</a></li><li><a href="#load-time-validation-is-great" class="table-of-contents__link toc-highlight">Load-time validation is great</a></li><li><a href="#hybrid-oo-ecs-works-really-well" class="table-of-contents__link toc-highlight">Hybrid OO-ECS works really well.</a></li><li><a href="#sometimes-its-best-not-to-implement-something-and-to-instead-have-glue-code" class="table-of-contents__link toc-highlight">Sometimes it&#39;s best <em>not</em> to implement something, and to instead have glue-code.</a></li><li><a href="#custom-entity-data-structures" class="table-of-contents__link toc-highlight">Custom entity data structures</a></li><li><a href="#things-that-worked-well-for-umg" class="table-of-contents__link toc-highlight">Things that worked well for UMG:</a></li><li><a href="#events" class="table-of-contents__link toc-highlight">Events:</a></li><li><a href="#lets-talk-about-flexibility" class="table-of-contents__link toc-highlight">Lets talk about &quot;flexibility.&quot;</a></li><li><a href="#hard-limitations-are-good" class="table-of-contents__link toc-highlight">Hard limitations are good</a></li><li><a href="#entity-archetypes" class="table-of-contents__link toc-highlight">Entity Archetypes</a></li><li><a href="#smart-eventquestion-buses" class="table-of-contents__link toc-highlight">Smart event/question buses:</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro/">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://steampowered.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Steam<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/n6N24cUMDA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/UntitledModGame" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022-2024 CodeTheory Limited</div></div></div></footer></div>
<script src="/assets/js/runtime~main.558f61a8.js"></script>
<script src="/assets/js/main.bdb3d79f.js"></script>
</body>
</html>